
.proc scrollH

    jsr     HGR
resetScroll:
    lda     #0
    sta     bufferOffset
scrollLoop:
    ldx     #0
    ldy     bufferOffset
drawLoop:
    lda     buffer+$000,y
    sta     $2000,x
    lda     buffer+$080,y
    sta     $2400,x
    lda     buffer+$100,y
    sta     $2800,x
    lda     buffer+$180,y
    sta     $2C00,x
    lda     buffer+$200,y
    sta     $3000,x
    lda     buffer+$280,y
    sta     $3400,x
    lda     buffer+$300,y
    sta     $3800,x
    lda     buffer+$380,y
    sta     $3C00,x
    lda     buffer+$400,y
    sta     $2080,x
    lda     buffer+$480,y
    sta     $2480,x
    lda     buffer+$500,y
    sta     $2880,x
    lda     buffer+$580,y
    sta     $2C80,x
    lda     buffer+$600,y
    sta     $3080,x
    lda     buffer+$680,y
    sta     $3480,x
    lda     buffer+$700,y
    sta     $3880,x
    lda     buffer+$780,y
    sta     $3C80,x
    iny
    inx
    cpx     #40
    bne     drawLoop

    inc     bufferOffset
    lda     bufferOffset
    cmp     #39
    bne     scrollLoop
    jmp     resetScroll

bufferOffset:   .byte   0

    .align  256

buffer:
row0:
    .byte   $FF,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $FF,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .res    128-80
row1:
    .byte   $00,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .res    128-80
row2:
    .byte   $00,$00,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .res    128-80
row3:
    .byte   $00,$00,$00,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .res    128-80
row4:
    .byte   $00,$00,$00,$00,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .res    128-80
row5:
    .byte   $00,$00,$00,$00,$00,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .res    128-80
row6:
    .byte   $00,$00,$00,$00,$00,$00,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .res    128-80
row7:
    .byte   $00,$00,$00,$00,$00,$00,$00,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .res    128-80
row8:
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .res    128-80
row9:
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .res    128-80
row10:
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .res    128-80
row11:
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$FF,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$FF,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .res    128-80
row12:
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$FF,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$FF,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .res    128-80
row13:
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$FF,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$FF,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .res    128-80
row14:
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$FF,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$FF,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .res    128-80
row15:
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$FF,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$FF,$00,$00,$00,$00
    .byte   $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00

.endproc

.macro writeScreen adrs,row
    sta     adrs+((row)&7)*$400+(((row)>>3)&7)*$80+(((row)>>6)&7)*$28
.endmacro

SCROLL_MASK     =   $FE

.proc scrollV

    jsr             HGR

drawLoop:

    lda             offset1
    and             #SCROLL_MASK
    tay
.repeat 128,row
    lda             buffer0+row*2,y
    writeScreen     $2000, row+16
    lda             buffer0+row*2+1,y
    writeScreen     $2001, row+16
.endrepeat
    inc             offset1
    inc             offset1

    lda             offset2
    and             #SCROLL_MASK
    tay
.repeat 128,row
    lda             buffer0+row*2,y
    writeScreen     $2002, row+16
    lda             buffer0+row*2+1,y
    writeScreen     $2003, row+16
.endrepeat
    inc             offset2

    lda             offset3
    and             #SCROLL_MASK
    tay
.repeat 128,row
    lda             buffer1+row*2,y
    writeScreen     $2004, row+16
    lda             buffer1+row*2+1,y
    writeScreen     $2005, row+16
.endrepeat
    dec             offset3
    dec             offset3

    lda             offset4
    and             #SCROLL_MASK
    tay
.repeat 128,row
    lda             buffer0+row*2,y
    writeScreen     $2006, row+16
    lda             buffer0+row*2+1,y
    writeScreen     $2007, row+16
.endrepeat
    clc
    lda             offset4
    adc             #4
    sta             offset4

;    ldx             #0
;:
;    dex
;    bne     :-

    ; wait for keypress
    lda             KBD
    bmi             :+
    jmp             drawLoop
:
    bit             KBDSTRB
    cmp             #KEY_ESC
    bne             :+
    jmp             quit
:
    sta             SPEAKER
    jmp             drawLoop

offset1:    .byte   0
offset2:    .byte   12
offset3:    .byte   64
offset4:    .byte   0

.align 256

; 256 bytes, x2
buffer0:
.repeat 2

; car1 blue (16)
    .byte $D0,$82,$DC,$86,$DC,$86,$D0,$82
    .byte $D0,$82,$DC,$86,$DC,$86,$D0,$82

; blank (16)
    .byte $00,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$00

; car2 (32)
    .byte $40,$01,$70,$07,$74,$0B,$34,$0B
    .byte $30,$07,$30,$07,$30,$07,$30,$07
    .byte $30,$07,$30,$07,$30,$07,$30,$07
    .byte $34,$0B,$74,$0B,$70,$07,$40,$01

; blank (16)
    .byte $00,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$00

;; truck down (48)
;    .byte $00,$00,$FC,$9F,$FD,$AF,$FD,$AF
;    .byte $FD,$AF,$FD,$AF,$FC,$9F,$FC,$9F
;    .byte $FC,$9F,$FC,$9F,$FC,$9F,$FD,$AF
;    .byte $FD,$AF,$FD,$AF,$FD,$AF,$FC,$9F
;    .byte $00,$00,$FC,$9F,$FD,$AF,$FD,$AF
;    .byte $8D,$AE,$8D,$AE,$FC,$9F,$00,$00

; truck up (48)
    .byte $00,$00,$FC,$9F,$8D,$AE,$8D,$AE
    .byte $FD,$AF,$FD,$AF,$FC,$9F,$00,$00
    .byte $FC,$9F,$FD,$AF,$FD,$AF,$FD,$AF
    .byte $FD,$AF,$FC,$9F,$FC,$9F,$FC,$9F
    .byte $FC,$9F,$FC,$9F,$FD,$AF,$FD,$AF
    .byte $FD,$AF,$FD,$AF,$FC,$9F,$80,$80

; ----

; blank (16)
    .byte $00,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$00

; blank (16)
    .byte $00,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$00

; blank (16)
    .byte $00,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$00

; blank (16)
    .byte $00,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$00

; car1 red (16)
    .byte $A0,$85,$AC,$9D,$AC,$9D,$A0,$85
    .byte $A0,$85,$AC,$9D,$AC,$9D,$A0,$85

; blank (16)
    .byte $00,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$00

; blank (16)
    .byte $00,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$00

; blank (16)
    .byte $00,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$00

.endrepeat

; 256 bytes, x2
buffer1:
.repeat 2

; car1 blue (16)
    .byte $D0,$82,$DC,$86,$DC,$86,$D0,$82
    .byte $D0,$82,$DC,$86,$DC,$86,$D0,$82

; blank (16)
    .byte $00,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$00

; car2 (32)
    .byte $40,$01,$70,$07,$74,$0B,$34,$0B
    .byte $30,$07,$30,$07,$30,$07,$30,$07
    .byte $30,$07,$30,$07,$30,$07,$30,$07
    .byte $34,$0B,$74,$0B,$70,$07,$40,$01

; blank (16)
    .byte $00,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$00

; truck down (48)
    .byte $00,$00,$FC,$9F,$FD,$AF,$FD,$AF
    .byte $FD,$AF,$FD,$AF,$FC,$9F,$FC,$9F
    .byte $FC,$9F,$FC,$9F,$FC,$9F,$FD,$AF
    .byte $FD,$AF,$FD,$AF,$FD,$AF,$FC,$9F
    .byte $00,$00,$FC,$9F,$FD,$AF,$FD,$AF
    .byte $8D,$AE,$8D,$AE,$FC,$9F,$00,$00

;; truck up (48)
;    .byte $00,$00,$FC,$9F,$8D,$AE,$8D,$AE
;    .byte $FD,$AF,$FD,$AF,$FC,$9F,$00,$00
;    .byte $FC,$9F,$FD,$AF,$FD,$AF,$FD,$AF
;    .byte $FD,$AF,$FC,$9F,$FC,$9F,$FC,$9F
;    .byte $FC,$9F,$FC,$9F,$FD,$AF,$FD,$AF
;    .byte $FD,$AF,$FD,$AF,$FC,$9F,$80,$80

; ----

; blank (16)
    .byte $00,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$00

; blank (16)
    .byte $00,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$00

; blank (16)
    .byte $00,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$00

; blank (16)
    .byte $00,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$00

; car1 red (16)
    .byte $A0,$85,$AC,$9D,$AC,$9D,$A0,$85
    .byte $A0,$85,$AC,$9D,$AC,$9D,$A0,$85

; blank (16)
    .byte $00,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$00

; blank (16)
    .byte $00,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$00

; blank (16)
    .byte $00,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$00

.endrepeat

.endproc